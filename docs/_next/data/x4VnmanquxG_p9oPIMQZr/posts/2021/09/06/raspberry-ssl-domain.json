{"pageProps":{"page":{"type":"posts","prev":{"header":{"title":"[라즈베리파이 4] 라즈베리파이에 도메인 입히기","excerpt":"지금까지 과정을 거치면서 라즈베리파이에 OS를 설치하고, Tomcat을 구동하여 웹 서버로 동작할 수 있도록 환경을 구축했다. 이제 우리는 라즈베리파이의 IP로 접속하여 웹 사이트를 호스팅할 수 있다. 하지만 정상적인 페이지라면 IP를 입력하여 접속하지 않는다. Domain을 발급받아 IP에 연동하고, 이를 URL 주소로 사용할 것이다. 이 장에서는 Domain을 직접 구입하고 라즈베리파이 서버에 이를 연동한다.","coverImage":"https://user-images.githubusercontent.com/50317129/131238727-666f2aaa-d759-4f62-af73-3856086da73d.png","date":"2021-09-04T12:09:04","type":"posts","category":"RaspberryPi","tag":["라즈베리파이","Ubuntu","도메인"],"comment":true,"publish":true},"name":"2021-09-04-raspberry-domain.md","content":"\r\n# 개요\r\n\r\n지금까지 과정을 거치면서 라즈베리파이에 OS를 설치하고, Tomcat을 구동하여 웹 서버로 동작할 수 있도록 환경을 구축했다.\r\n\r\n이제 우리는 라즈베리파이의 IP로 접속하여 웹 사이트를 호스팅할 수 있다.\r\n\r\n하지만 정상적인 페이지라면 IP를 입력하여 접속하지 않는다. Domain을 발급받아 IP에 연동하고, 이를 URL 주소로 사용할 것이다.\r\n\r\n이 장에서는 Domain을 직접 구입하고 라즈베리파이 서버에 이를 연동한다.\r\n\r\n# 무슨 도메인을 쓰지?\r\n\r\n일전 [게시글](/posts/2021/08/18/freenom-domain)에서 Freenom을 통해 무료로 도메인을 받는 과정에 대해 다룬적이 있다.\r\n\r\n무료도 상관없지만, Freenom은 실 서비스에 사용하기에 매우 부적합하다.\r\n\r\nTLD 중 어떤 걸 사용할까 고민했다. 개인적으론 `io` 도메인의 트렌디함에 끌렸지만, 가비아 기준 도메인 비용이 무려 연 20만원... 반드시 `io`가 필요하지도 않은 마당에 연에 20을 태우는 건 너무 비효율적이라 생각했다.\r\n\r\n원랜 대중적인 `com`으로 하려했으나, 조사 중 `dev`라는 개발자스러운 도메인이 있음을 확인하여 이를 선택하기로 했다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132054483-01b3e988-376d-444f-9d5e-8415368e0822.png)\r\n\r\n[Google Domains](https://domains.google/)에서 구매하기로 했으며, Google Domains 기준 일반가는 12$다.\r\n\r\n<br />\r\n\r\n뭐든지 네이밍이 제일 어렵다. 게임 캐릭터 닉네임을 정하는 것도 그렇고, 변수명을 짓는 것도 그렇다.\r\n\r\n유명한 도메인인 `socket.io`처럼 뭔가 `dev`를 적절히 이용하여 하나의 문장처럼 보이는 도메인을 생성하고 싶었다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132054569-31a96ab2-652f-4631-849f-759d3c82f823.png)\r\n\r\n<br />\r\n\r\n<p class=\"orange-600\" align=\"center\">단어에 따라 프리미엄가가 붙기도 하며, 단어의 고유화 정도에 따라 같은 프리미엄이라도 가격이 다르게 적용된다.</p>\r\n\r\n<br />\r\n\r\n그렇다고 너무 <span class=\"amber-600\">범용적인 단어를 사용하면 프리미엄</span>이랍시고 가격을 매우 비싸게 받는다.... 일례로 `unix.dev`는 unix라는 보통명사가 들어갔음에도 아직 발급되지 않았는데, 프리미엄 가격이 무려 1,000$가 넘어간다. `webapps.dev`도 매우 비싸긴 마찬가지.\r\n\r\n하지만 여러 단어를 조합해서 만드는 문장은 인식을 잘 못하는지, 찾다보면 꽤 괜찮은 도메인임에도 프리미엄이 붙지 않기도 하다.\r\n\r\n고민끝에 선정한 후보는 아래와 같다.\r\n\r\n* itcode.dev\r\n* mustdo.dev\r\n* imnow.dev\r\n\r\n셋 다 프리미엄이 붙지 않으며, 최대한 도메인에 개발자스러움을 담았다. 원랜 `mustdo.dev`로 하려 했으나, `itcode.dev`의 깔끔함 때문에 막판에 이 쪽으로 선회했다.\r\n\r\n# Google Domains에서 도메인 발급받기\r\n\r\n도메인을 발급받을 수 있는 사이트는 여러군데가 있으나, 이 장에서는 Google Domains를 기준으로 설명한다.\r\n\r\n이유는 그냥 구글이라서.\r\n\r\n## 준비물\r\n\r\n* 서버\r\n* 해외결제를 지원하는 결제수단\r\n\r\n필자가 도메인을 발급받을 때 필요했던 준비물은 위와 같다.\r\n\r\n만약 Google Domains가 아닌 국내 사이트에서 결제한다면 해외결제는 신경쓰지 않아도 된다. Google의 경우 해외 서비스이므로 해외결제가 지원되야 한다.\r\n\r\n## 1. 도메인 결정하기\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132057934-b103e4ef-157d-46e1-b9aa-52a9b8f273c1.png)\r\n\r\n원하는 도메인을 검색하자.\r\n\r\n도메인을 골랐다면 우측 가운데 [카트] 버튼을 클릭하여 장바구니에 담는다.\r\n\r\n`dev` 도메인과 같이 몇몇 일부 도메인은 <span class=\"red-400\">More secure</span> 정책이 적용되어 SSL을 강제한다.\r\n\r\n이러한 정책이 적용된 도메인은 <span class=\"red-600\">HTTP 서비스가 불가능하며, 반드시 HTTPS 서비스만을 제공</span>함에 유의하자.\r\n\r\n## 2. 화폐 단위 선택하기\r\n\r\n첫 결제라면 결제할 화폐 단위를 선택해야한다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132058739-2766fbd9-791c-4e19-971f-7520e46de5b2.png)\r\n\r\n아쉽게도 원화는 지원되지 않으므로, 지원되는 화폐 중 하나를 선택한다.\r\n\r\n이 장에서는 달러($)를 기준으로 수행한다.\r\n\r\n> <span class=\"yellow-600\">해외결제의 경우 달러가 수수료 측면에서 이득이다</span>  \r\n> 필자는 군대 전역 후 카드사 콜센터에서 잠깐 일을 한 적이 있었다. 거기서 얻은 지식 중 하나로, <span class=\"orange-600\">해외결제는 달러를 기준으로 환전</span>한다. 만약 원화 -> 유로로 결제한다면, 실제론 <span class=\"blue-600\">원화 -> 달러 -> 유로</span>로 두 차례 환전이 일어나 수수료 역시 이중으로 나간다.  \r\n> 이는 해외에서 원화를 결제할때도 마찬가지. 해외에서 국내 카드로 원화결제를 수행할 경우 <span class=\"blue-600\">원화 -> 달러 -> 원화</span>라는 해괴한 매커니즘으로 결제되니, 해외결제는 그냥 속편하게 달러로 하자.\r\n\r\n## 3. 사용자 정보 입력\r\n\r\n첫 결재라면 도메인 소유주 정보를 입력받는다. 적절히 입력하자.\r\n\r\n우편번호의 경우 <span class=\"red-600\">미국 우편번호만을 입력</span>받으니, 구글에 그냥 미국 주소 아무거나 쳐서 우편번호 하나 확인하여 입력하자.\r\n\r\n## 4. 도메인 구매\r\n\r\n도메인 구매를 수행한다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132058813-3eb136bc-d801-40ac-a1c3-83a68478f6e4.png)\r\n\r\n<span class=\"red-600\">[Read trademark notice]</span>는 starcraft라는 브랜드명을 도메인으로 사용함에 따라 관련 약관의 동의를 받는 것이다.\r\n\r\n일반적인 도메인엔 해당 과정이 존재하지 않다.\r\n\r\n* <span class=\"amber-600\">Registration</span> - 소유 기간 선택 (최소 1년)\r\n* <span class=\"amber-600\">Privacy protection is on</span> - 도메인 소유주 정보를 숨긴다. 후이즈(WHOIS) 등에서 도메인 정보를 조회할 경우, 소유주에 대한 정보를 숨긴 채 제공한다.\r\n* <span class=\"amber-600\">Auto-renew is on</span> - 도메인 자동 갱신 활성화\r\n* <span class=\"grey-600\">Custom email</span> - 도메인 이메일계정 활성화\r\n\r\nCustom email은 자신의 도메인으로 된 구글 이메일을 만드는 것이다. 즉, `example@starcraft.dev`와 같이 <span class=\"orange-500\">자신이 구입한 도메인으로 이메일 아이디를 생성</span>해주는 서비스다.\r\n\r\n물론 무료는 아니고, 유저당 월 12$ 비용이 청구된다. 도메인 유지 비용이 연 12$임을 감안하면 10배에 달하는 비용이다. 비즈니스 등 반드시 필요한 서비스가 아니라면 해당 서비스는 체크를 해제하자.\r\n\r\n# IP와 도메인 연결하기\r\n\r\n도메인 구입이 완료되면 소유주 정보에 입력한 이메일로 구매 영수증과 함께 안내 메일이 수신된다.\r\n\r\n구입 이후 도메인은 즉시 사용이 가능하다. 이 도메인을 라즈베리파이에 연동하기 위해선 DNS 설정을 통해 <span class=\"green-600\">라즈베이파이의 IP와 도메인을 연결</span>해주면 된다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132080600-d1083686-ceb4-4046-a6ab-c4a0c7a83f90.png)\r\n\r\nGoogle Domains의 DNS 메뉴에서 DNS 설정을 관리할 수 있다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132080643-7a92c2ec-8b8a-4428-b4c3-4ba149bb6875.png)\r\n\r\n[맞춤 레코드 관리]를 클릭하여 DNS Record를 추가한다.\r\n\r\n<span class=\"green-600\">A Record를 하나 추가하여 데이터에 라즈베리파이의 IP를 입력</span>하고 저장한다. 수 분 이내로 반영이 완료된다.\r\n\r\n> <b class=\"teal-A400\">사설 IP 입력? 멈춰!</b>  \r\n> 공유기 환경을 사용한다면 IP 확인 시 <span class=\"pink-600\">192.168.0.xxx</span>와 같은 사설 IP가 출력될 것이다. A Record엔 사설 IP가 아닌 실제 IP를 입력해야한다. 공유기 설정이나 [findIP](https://www.findip.kr/)에서 확인할 수 있다.\r\n\r\n# 도메인 연동 확인\r\n\r\n``` bash\r\nnslookup [도메인]\r\n```\r\n\r\n윈도우든 Ubuntu든 위 명령어를 입력하여 도메인과 연동된 IP를 확인할 수 있다.\r\n\r\n내가 입력한 IP가 정상적으로 나온다면 성공이다.\r\n\r\n라즈베리파이에서 Tomcat을 기동하고 `example.com:8080`에 접속하여 페이지가 잘 출력되는지 확인하자.\r\n\r\n## 연결이 되지 않아요!\r\n\r\n* `xxx.xxx.xxx.xxx:8080`으로 접속되는지 확인\r\n* 접속이 될 경우 외부에서 문제없이 접속되므로, 도메인에 연결한 IP가 올바른지 확인\r\n* 접속되지 않을 경우 애초에 외부에서 접속되지 않는 것이므로 방화벽이나 포트 통신에 문제가 없는지 확인\r\n* 공유기 환경일 경우 IP주소의 포트포워딩이 설정되어있는지 확인\r\n\r\n# 목표\r\n\r\n* <del class=\"grey-400\">라즈베리파이에 Ubuntu 서버를 구축한다.</del>\r\n* <del class=\"grey-400\">Tomcat을 구동하여 페이지를 호스팅한다.</del>\r\n* <del class=\"grey-400\">도메인을 입힌다.</del>\r\n* SSL 인증서를 발급하여 HTTPS 통신을 제공한다.\r\n* SSH, RDP 등의 원격 통신환경을 구축한다.\r\n* MariaDB를 설치하여 DB 통신을 수행한다.\r\n\r\n`dev` 도메인은 반드시 SSL이 필요하다. 더군다나 현재에 배포되는 모든 웹 페이지엔 HTTPS 적용을 거의 강제하다시피 함으로 HTTPS 적용을 목표에 추가한다.","url":["2021-09-04-raspberry-domain","2021","09","04","raspberry-domain"]},"next":{"header":{"title":"[라즈베리파이 4] 원격 환경 구축하기 (SSH, RDP)","excerpt":"이제 얼추 라즈베리파이에 그럴듯한 웹서버 환경이 구축됐다. 하지만 라즈베리파이를 다루기 위해서 기기에 직접 모니터랑 키보드, 마우스를 연결해서 쓰긴 좀 번거롭다. 이 주제에서의 라즈베리파이는 어디까지나 서브로 운영되는 웹서버이므로, 메인 컴퓨터가 될 수 없다. 즉, 개발같은 대부분의 작업은 메인 컴퓨터에서 진행하고, 배포만 서버가 담당하는 방식이다. 이렇게 디바이스가 서로 나뉠 경우, 두 디바이스의 접근이 서로 원활해야한다. 한 마디로, 원격 환경이 필요하다. 이 장에서는 라즈베리파이에 원격 환경을 구축한다. SSH, RDP 통신을 구축함으로써 SSH 혹은 윈도우 PC 어디에서나 라즈베리파이에 접근할 수 있도록 구성한다.","coverImage":"https://user-images.githubusercontent.com/50317129/131238727-666f2aaa-d759-4f62-af73-3856086da73d.png","date":"2021-09-08T22:40:38","type":"posts","category":"RaspberryPi","tag":["라즈베리파이","Ubuntu","SSH","RDP"],"comment":true,"publish":true},"name":"2021-09-08-raspberry-remote.md","content":"\r\n# 개요\r\n\r\n이제 얼추 라즈베리파이에 그럴듯한 웹서버 환경이 구축됐다. 하지만 라즈베리파이를 다루기 위해서 기기에 직접 모니터랑 키보드, 마우스를 연결해서 쓰긴 좀 번거롭다.\r\n\r\n이 주제에서의 라즈베리파이는 어디까지나 서브로 운영되는 웹서버이므로, 메인 컴퓨터가 될 수 없다. 즉, 개발같은 대부분의 작업은 메인 컴퓨터에서 진행하고, 배포만 서버가 담당하는 방식이다. 이렇게 디바이스가 서로 나뉠 경우, 두 디바이스의 접근이 서로 원활해야한다.\r\n\r\n한 마디로, 원격 환경이 필요하다. 이 장에서는 <span class=\"amber-600\">라즈베리파이에 원격 환경을 구축</span>한다. <span class=\"primary\">SSH</span>, <span class=\"primary\">RDP</span> 통신을 구축함으로써 SSH 혹은 윈도우 PC 어디에서나 라즈베리파이에 접근할 수 있도록 구성한다.\r\n\r\n# SSH 환경 구축하기\r\n\r\n<span class=\"primary\">SSH(Secure SHell)</span>는 네트워크에 연결된 PC에 로그인하여 원격 PC에서 해당 PC로 명령어를 실행하는 등의 Shell 통신을 수행하는 프로토콜이다.\r\n\r\nSSH 환경을 구축하여 원격으로 Ubuntu Shell에 접근할 수 있다. 이를 통해 원격으로 명령어를 입력하여 Ubuntu를 다룰 수 있다. Windows와 달리 Linux는 거의 모든 프로그램이 명령어 기반으로 동작하므로 어려움없이 Ubuntu를 다룰 수 있다.\r\n\r\n## 준비물\r\n\r\n* openssh-server 패키지\r\n* SSH(22) 서비스 포트 개방\r\n\r\n## OpenSSH Server 패키지 설치\r\n\r\nOpenSSH 패키지는 크게 두 가지가 있는데, 하나는 OpenSSH Client, 다른 하나는 OpenSSH Server다.\r\n\r\n* <span class=\"teal-500\">OpenSSH Server</span> - 해당 OS에 SSH 서비스 환경을 구축함\r\n* <span class=\"teal-500\">OpenSSH Client</span> - 타 PC의 SSH 접속 기능을 추가함\r\n\r\nOpenSSH Server를 설치하여 Ubuntu에 SSH에 접근할 수 있도록 환경을 구성하자.\r\n\r\n``` bash\r\nsudo apt-get install -y openssh-server\r\n```\r\n\r\n설치후 추가로 해야할 작업은 없다.\r\n\r\n## 포트 개방\r\n\r\nSSH가 서비스되는 포트를 개방한다. 기본적으로 22번 포트를 사용한다.\r\n\r\n``` bash\r\nsudo ufw allow 22\r\n```\r\n\r\nufw를 통해 22번 포트를 개방한다.\r\n\r\n## SSH 접속하기\r\n\r\n다른 PC에서 Ubuntu로 접속해보자. Windows 혹은 다른 Linux 기반 OS 등, SSH 프로토콜을 사용할 수 있는 모든 OS 및 프로그램이라면 가능하다.\r\n\r\n``` bash\r\nssh username@xxx.xxx.xxx.xxx\r\n```\r\n\r\n위 명령어를 통해 입력한 IP와 계정명으로 접근을 시도할 수 있다. IP는 라즈베리파이의 IP를, 계정명은 라즈베리파이의 계정명을 입력하면 된다. IP 대신 도메인을 입력해도 된다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132518427-796d71c2-7331-4a99-8d7f-65eef29344bb.png)\r\n\r\n접속정보가 유효하다면 비밀번호를 입력하여 로그인을 수행해야한다. 로그인이 완료되면 Shell에 명령어를 입력할 수 있으며, 이를 통해 원격지에서도 Ubuntu를 다룰 수 있게된다.\r\n\r\n# RDP 환경 구축하기\r\n\r\n<p class=\"red-500\" align=\"center\">※ Ubuntu에 UI가 존재하는 Ubuntu Desktop 혹은 이에 준하는 UI 패키지가 설치된 OS에만 적용 가능합니다.</p>\r\n\r\n비록 Ubuntu가 대부분의 동작을 명령어로만 처리할 수 있긴 하지만, 간혹 몇몇 작업들은 반드시 UI가 필요하기도 하다. 이를테면 브라우저로 리눅스에서의 웹 페이지를 디버깅한다던가, 동영상을 본다던가. 혹시 Oracle DBMS를 설치하고자 한다면 반드시 UI를 사용할 수 있는 환경이 필요하다.\r\n\r\n심지어 우리가 설치한 Ubuntu도 UI가 있는데, 기껏 설치한 UI는 놀리고 SSH만 쓰기도 난감하다. 물론 라즈베리파이에 HDMI를 연결해서 쓰면 된다지만, 그 것도 번거롭긴 마찬가지다.\r\n\r\n내 경우 듀얼모니터를 사용하고 있어서 여건이 나쁘진 않다. 그러나 모니터가 하나라면 라즈베리파이를 연결한 순간 원래 PC는 사용이 제한되버린다.\r\n\r\n<br />\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132518566-fb8858ce-0b0c-4483-9a84-c3dc718f3e5f.png)\r\n\r\nWindows에는 <span class=\"primary\">원격 데스크톱 연결</span>이라는 기능이 존재한다. Windows 간 원격이 가능한 기능으로써, 팀뷰어나 AnyDesk를 생각하면 된다. 일종의 내장 원격 프로그램.\r\n\r\n말로만 들어보면 왠지 Windows 간 통신만 지원할 것 같다. 필자도 그렇게 생각했었다. 하지만 Ubuntu는 내 생각 이상으로 잡다한게 많았다. xrdp 패키지를 설치하면 Windows의 RDP와 통신이 가능하다.\r\n\r\n## 준비물\r\n\r\n* xrdp 패키지\r\n* RDP(3389) 서비스 포트 개방\r\n\r\n## xrdp 패키지 설치\r\n\r\n``` bash\r\nsudo apt-get install -y xrdp\r\n```\r\n\r\n위 명령어를 입력하여 설치한다.\r\n\r\n## 포트 개방\r\n\r\nRDP가 서비스되는 포트를 개방한다. 기본적으로 3389번 포트를 사용한다.\r\n\r\n``` bash\r\nsudo ufw allow 3389\r\n```\r\n\r\nufw를 통해 3389번 포트를 개방한다.\r\n\r\n## RDP 접속하기\r\n\r\n다른 Windows PC에서 Ubuntu로 접속해보자. 시작 프로그램에서 <span class=\"blue-400\">[원격 데스크톱 연결]</span>을 입력하여 프로그램을 실행하자.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132518999-0293653c-ccef-4181-a084-71022f83fc47.png)\r\n\r\nUbuntu IP를 입력하여 연결한다. 정상적으로 연결되면 Ubuntu의 접속정보를 통해 로그인을 수행한다.\r\n\r\n![image](https://user-images.githubusercontent.com/50317129/132519253-e4ec536d-d6a4-4fea-8905-50451a892a5b.png)\r\n\r\n접속에 성공하면 원격으로 Ununtu UI를 다룰 수 있게 된다. 하지만 여러 기술적 한계와 효용성으로 인해 성능이 그리 좋지는 않은 것 같다. 끊김 현상이 좀 심한 것으로 보인다.\r\n\r\n## 검은 화면만 나와요!\r\n\r\n분명히 정상적으로 잘 접속했는데, <span class=\"red-500\">검은화면만 뜨는 경우가 발생</span>하기도 한다.\r\n\r\n꽤 유명한 이슈로, 설정 몇 개만 수정하면 해결된다.\r\n\r\n``` bash\r\nsudo vi /etc/xrdp/startwm.sh\r\n\r\n# 파일의 맨 아랫 줄에 아래 내용 추가\r\nunset DBUS_SESSION_BUS_ADDRESS\r\nunset XDG_RUNTIME_DIR\r\n\r\ntest -x /etc/X11/Xsession && exec /etc/X11/Xsession\r\nexec /bin/sh /etc/X11/Xsession\r\n\r\n# 파일 저장\r\n:wq\r\n```\r\n\r\n`/etc/xrdp/startwm.sh` 파일에 위 내용을 추가하고 저장하면 된다.\r\n\r\n``` bash\r\nservice xrdp restart\r\n```\r\n\r\n이후 서비스를 재시작하고 시도하면 정상적으로 접속될 것이다.\r\n\r\n# 목표\r\n\r\n* <del class=\"grey-400\">라즈베리파이에 Ubuntu 서버를 구축한다.</del>\r\n* <del class=\"grey-400\">Tomcat을 구동하여 페이지를 호스팅한다.</del>\r\n* <del class=\"grey-400\">도메인을 입힌다.</del>\r\n* <del class=\"grey-400\">SSL 인증서를 발급하여 HTTPS 통신을 제공한다.</del>\r\n* <del class=\"grey-400\">SSH, RDP 등의 원격 통신환경을 구축한다.</del>\r\n* MariaDB를 설치하여 DB 통신을 수행한다.\r\n\r\n이로써 어디에서나 라즈베리파이의 Ubuntu에 접속하여 조작할 수 있다. Shell과 UI 둘 다 조작이 가능하므로 필요에 따라 원하는 방식으로 접근하면 될 것이다.","url":["2021-09-08-raspberry-remote","2021","09","08","raspberry-remote"]}},"group":[],"data":{"header":{"title":"[라즈베리파이 4] Let's Ecrypt로 Ubuntu 서버에 HTTPS 통신 제공하기","excerpt":"이전 장에서 Google Domains를 통해 dev 도메인을 발급받았다. 이 블로그의 주소는 실제로 구입한 https://blog.itcode.dev 도메인이 적용되어있다. dev 도메인은 강화된 보안정책이 적용되어있다. 해당 도메인으로의 모든 HTTP 통신은 반드시 HTTPS 보안 통신으로만 제공된다. 네트워크 계층에서 https 프로토콜로 라우팅하므로 좋든 싫든 HTTPS 서비스를 제공해야만 한다.","coverImage":"https://user-images.githubusercontent.com/50317129/131238727-666f2aaa-d759-4f62-af73-3856086da73d.png","date":"2021-09-06T16:50:40","type":"posts","category":"RaspberryPi","tag":["라즈베리파이","Ubuntu","Tomcat(톰캣)","SSL"],"comment":true,"publish":true},"name":"2021-09-06-raspberry-ssl-domain.md","content":"<h1 id=\"개요\">개요 <a href=\"#개요\">🔗</a></h1><p>이전 장에서 Google Domains를 통해 <code class=\"inline-code\">dev</code> 도메인을 발급받았다. 이 블로그의 주소는 실제로 구입한 https://blog.itcode.dev 도메인이 적용되어있다.</p>\n<p><code class=\"inline-code\">dev</code> 도메인은 강화된 보안정책이 적용되어있다. 해당 도메인으로의 모든 HTTP 통신은 반드시 HTTPS 보안 통신으로만 제공된다. 네트워크 계층에서 https 프로토콜로 라우팅하므로 좋든 싫든 HTTPS 서비스를 제공해야만 한다.</p>\n<br />\n\n<p>이 장에서는 Let's Encrypt로 SSL 인증서를 발급받아 라즈베이파이서버의 Tomcat에 적용한다. 기존의 1:1 도메인 매칭 SSL이 아니라, 여러 서브도메인에 전부 대응 가능한 와일드카드 인증서를 받을 것이다.</p>\n<blockquote>\n<p><b class=\"teal-600\">와일드카드(Wildcard) 인증서?</b><br>프로그래밍에서의 <span class=\"primary\">와일드카드</span>란 무작위 대상의 허용이란 의미를 가진다. 도메인과 1:1 매칭되는 기존의 인증서와 달리, 와일드카드 인증서는 주체가 <code class=\"inline-code\">*.example.com</code>로 표기되며, 모든 서브도메인에 적용이 가능하다.</p>\n</blockquote>\n<h1 id=\"Cerbot으로-SSL 인증서 발급하기\">Cerbot으로 SSL 인증서 발급하기 <a href=\"#Cerbot으로-SSL 인증서 발급하기\">🔗</a></h1><p>Ubuntu 서버에서 SSL 인증서를 발급받아보자. 일반적인 SSL 인증서는 인증 과정에서 웹 서버에 특정 파일을 배포한 뒤, 인증 서버에서 해당 파일의 접근 및 유효성 검증을 통해 도메인의 소유권을 확인한다.<br>하지만 와일드카드 인증서는 여러 서브도메인에 전부 적용되는 특별한 인증서라 위의 인증방식을 사용하지 않는다. 위의 인증방식은 하나의 도메인의 소유권만 보증하기 때문. <span class=\"orange-600\">와일드카드 인증서는 DNS 레코드를 통해 소유권을 인증</span>한다. DNS 레코드는 도메인의 소유권자만 설정 가능하기 때문.</p>\n<p>만약, 어떠한 이유로든 도메인의 DNS 설정을 변경할 수 없다면 와일드카드 인증서를 발급받을 수 없다.</p>\n<h2 id=\"어?-전 윈도우로 하고싶은데....\">어? 전 윈도우로 하고싶은데.... <a href=\"#어?-전 윈도우로 하고싶은데....\">🔗</a></h2><p>DNS 레코드 인증으로 진행하기 때문에 Tomcat에 파일을 배포할 필요가 없어서 아무데서나 진행해도 상관 없다.</p>\n<p>Windows 환경에서 인증서를 발급받는 방법은 이전에 작성한 게시물 <a href=\"/posts/2021/08/19/lets-encrypt\" target=\"_blank\">[SSL] Windows 10에서 Let's Encrypt로 SSL 인증서 무료 발급받기</a>을 참고하길 바란다.</p>\n<h2 id=\"준비물\">준비물 <a href=\"#준비물\">🔗</a></h2><ul>\n<li>Ubuntu OS</li>\n<li>DNS Record 설정 권한</li>\n</ul>\n<p>필자는 Google Domains에서 도메인을 구입했으므로, Google Domains에서 DNS 설정을 관리할 수 있다. 만약, 가비아나 후이즈, 도레지 등 다른 도메인 사이트에서 도메인을 구매했다면 그 사이트에서 DNS 설정을 할 수 있으니 참고할 것.</p>\n<p>이 장에서는 Google Domains를 기준으로 진행한다.</p>\n<h2 id=\"1.-Certbot 설치하기\">1. Certbot 설치하기 <a href=\"#1.-Certbot 설치하기\">🔗</a></h2><p>Ubuntu에서 Certbot을 설치한다.</p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>BASH</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-bash\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> certbot</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<h2 id=\"2.-Certbot으로 인증 수행하기\">2. Certbot으로 인증 수행하기 <a href=\"#2.-Certbot으로 인증 수행하기\">🔗</a></h2><p>Certbot을 수행하여 인증서 발급을 수행한다.</p>\n<p class=\"red-500\" align=\"center\">※ 아래의 itcode.dev 도메인은 예시로, 실제로 입력 시엔 직접 사용할 자신의 도메인을 입력한다.</p>\n\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>BASH</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-bash\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0><span class=\"token function\">sudo</span> certbot certonly --manual --preferred-challenges dns --email psj2716@gmail.com -d *.itcode.dev</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<ul>\n<li><code class=\"inline-code\">--manual</code> - 수동 설정</li>\n<li><code class=\"inline-code\">--preferred-challenges</code> - 인증방식 지정</li>\n<li><code class=\"inline-code\">--email</code> 소유주 이메일</li>\n<li><code class=\"inline-code\">-d</code> - 도메인 지정</li>\n</ul>\n<p>위 명령어를 사용하면 별다른 명령어 입력 없이 즉시 인증을 수행할 수 있다. <code class=\"inline-code\">-d</code>의 인자값으로 구입한 도메인을 입력하되, 서브도메인을 <code class=\"inline-code\">*</code>로 지정함을 잊지말자.</p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>OUTPUT</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-output\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=1><td class=\"line-number\" data-number=\"1\">1</td><td class=\"line-code\" data-number=1>Please read the Terms of Service at</td></tr>\n<tr data-number=2><td class=\"line-number\" data-number=\"2\">2</td><td class=\"line-code\" data-number=2>https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must</td></tr>\n<tr data-number=3><td class=\"line-number\" data-number=\"3\">3</td><td class=\"line-code\" data-number=3>agree in order to register with the ACME server at</td></tr>\n<tr data-number=4><td class=\"line-number\" data-number=\"4\">4</td><td class=\"line-code\" data-number=4>https://acme-v02.api.letsencrypt.org/directory</td></tr>\n<tr data-number=5><td class=\"line-number\" data-number=\"5\">5</td><td class=\"line-code\" data-number=5>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=6><td class=\"line-number\" data-number=\"6\">6</td><td class=\"line-code\" data-number=6>(A)gree/(C)ancel:</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p><span class=\"pink-600\">서비스 이용 약관에 동의</span>해달라는 의미로, A를 입력하여 동의한다. 동의하지 않으면 SSL 발급을 진행할 수 없다.</p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>OUTPUT</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-output\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=1><td class=\"line-number\" data-number=\"1\">1</td><td class=\"line-code\" data-number=1>Would you be willing to share your email address with the Electronic Frontier</td></tr>\n<tr data-number=2><td class=\"line-number\" data-number=\"2\">2</td><td class=\"line-code\" data-number=2>Foundation, a founding partner of the Let's Encrypt project and the non-profit</td></tr>\n<tr data-number=3><td class=\"line-number\" data-number=\"3\">3</td><td class=\"line-code\" data-number=3>organization that develops Certbot? We'd like to send you email about our work</td></tr>\n<tr data-number=4><td class=\"line-number\" data-number=\"4\">4</td><td class=\"line-code\" data-number=4>encrypting the web, EFF news, campaigns, and ways to support digital freedom.</td></tr>\n<tr data-number=5><td class=\"line-number\" data-number=\"5\">5</td><td class=\"line-code\" data-number=5>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=6><td class=\"line-number\" data-number=\"6\">6</td><td class=\"line-code\" data-number=6>(Y)es/(N)o:</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p>Certbot 개발기관에서 웹 암호화, EFF 뉴스, 이벤트 등의 <span class=\"pink-600\">정보를 소유주의 이메일로 발송</span>하는데 동의하냐는 질문이다.</p>\n<p>좋으면 Y, 싫으면 N을 입력하자. <span class=\"red-400\">동의하지 않아도 SSL 발급엔 지장없다.</span></p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>OUTPUT</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-output\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=1><td class=\"line-number\" data-number=\"1\">1</td><td class=\"line-code\" data-number=1>NOTE: The IP of this machine will be publicly logged as having requested this</td></tr>\n<tr data-number=2><td class=\"line-number\" data-number=\"2\">2</td><td class=\"line-code\" data-number=2>certificate. If you're running certbot in manual mode on a machine that is not</td></tr>\n<tr data-number=3><td class=\"line-number\" data-number=\"3\">3</td><td class=\"line-code\" data-number=3>your server, please ensure you're okay with that.</td></tr>\n<tr data-number=4><td class=\"line-number\" data-number=\"4\">4</td><td class=\"line-code\" data-number=4></td></tr>\n<tr data-number=5><td class=\"line-number\" data-number=\"5\">5</td><td class=\"line-code\" data-number=5>Are you OK with your IP being logged?</td></tr>\n<tr data-number=6><td class=\"line-number\" data-number=\"6\">6</td><td class=\"line-code\" data-number=6>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=7><td class=\"line-number\" data-number=\"7\">7</td><td class=\"line-code\" data-number=7>(Y)es/(N)o:</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p><span class=\"pink-600\">IP 수집에 동의</span>하냐는 질문으로, Y를 입력하여 동의한다. 동의하지 않으면 SSL 발급을 진행할 수 없다.</p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>OUTPUT</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-output\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=1><td class=\"line-number\" data-number=\"1\">1</td><td class=\"line-code\" data-number=1>Please deploy a DNS TXT record under the name</td></tr>\n<tr data-number=2><td class=\"line-number\" data-number=\"2\">2</td><td class=\"line-code\" data-number=2>_acme-challenge.itcode.dev with the following value:</td></tr>\n<tr data-number=3><td class=\"line-number\" data-number=\"3\">3</td><td class=\"line-code\" data-number=3></td></tr>\n<tr data-number=4><td class=\"line-number\" data-number=\"4\">4</td><td class=\"line-code\" data-number=4>1sz-pJgM-3jL7mZacyByOO0S2lclAF0QmxtqujRuRHM</td></tr>\n<tr data-number=5><td class=\"line-number\" data-number=\"5\">5</td><td class=\"line-code\" data-number=5></td></tr>\n<tr data-number=6><td class=\"line-number\" data-number=\"6\">6</td><td class=\"line-code\" data-number=6>Before continuing, verify the record is deployed.</td></tr>\n<tr data-number=7><td class=\"line-number\" data-number=\"7\">7</td><td class=\"line-code\" data-number=7>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</td></tr>\n<tr data-number=8><td class=\"line-number\" data-number=\"8\">8</td><td class=\"line-code\" data-number=8>Press Enter to Continue</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p>certbot에서 서브도메인명 <code class=\"inline-code\">_acme-challenge</code>과 랜덤한 문자열을 제공한다. 제시한 도메인 <code class=\"inline-code\">_acme-challenge.itcode.dev</code>의 DNS TXT Record에 제공한 값 <code class=\"inline-code\">O3WQbIWv73aOzneZBu_4XAoE9ieZT1ZLdvbX7UPCkyk</code>을 할당하면 된다.</p>\n<p>도메인은 사용자가 입력한 값에 따라 달라지니 참고할 것.</p>\n<h2 id=\"3.-DNS TXT Record 설정\">3. DNS TXT Record 설정 <a href=\"#3.-DNS TXT Record 설정\">🔗</a></h2><p>DNS Record 종류엔 A, CNAME 등 여러 종류가 존재한다. 이 중 TXT 레코드에 값을 할당하면 된다.</p>\n<p>Google Domains의 DNS 설정에서 Record 하나를 추가하고, 타입을 TXT로 설정한다. 이후 certbot에서 제시한 값을 입력한다. 설정한 DNS 정보가 전파되기까지 수 분의 시간이 걸릴 수 있다. Google Domains의 경우 전파속도는 빠른 것 같다.</p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>BASH</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-bash\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0><span class=\"token function\">nslookup</span> -q<span class=\"token operator\">=</span>txt _acme-challenge.itcode.dev</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p>TXT Record이므로 브라우저에서 해당 도메인에 접근해도 별다른 내용이 출력되지 않는다. <code class=\"inline-code\">nslookup</code> 명령어를 통해 Record의 종류를 지정하여 조회해야한다.</p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>OUTPUT</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-output\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0>Server:         127.0.0.53</td></tr>\n<tr data-number=1><td class=\"line-number\" data-number=\"1\">1</td><td class=\"line-code\" data-number=1>Address:        127.0.0.53#53</td></tr>\n<tr data-number=2><td class=\"line-number\" data-number=\"2\">2</td><td class=\"line-code\" data-number=2></td></tr>\n<tr data-number=3><td class=\"line-number\" data-number=\"3\">3</td><td class=\"line-code\" data-number=3>Non-authoritative answer:</td></tr>\n<tr data-number=4><td class=\"line-number\" data-number=\"4\">4</td><td class=\"line-code\" data-number=4>_acme-challenge.itcode.dev      text = \"1sz-pJgM-3jL7mZacyByOO0S2lclAF0QmxtqujRuRHM\"</td></tr>\n<tr data-number=5><td class=\"line-number\" data-number=\"5\">5</td><td class=\"line-code\" data-number=5></td></tr>\n<tr data-number=6><td class=\"line-number\" data-number=\"6\">6</td><td class=\"line-code\" data-number=6>Authoritative answers can be found from:</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p>위 처럼 해당 도메인의 TXT Record에 입력한 문자열이 나오면 DNS 설정이 전파된 것으로, 인증을 진행할 수 있다. 만약, 값이 나오지 않는다면 시간을 두고 기다리자.</p>\n<p>Enter를 누르면 인증확인을 시도하는데, DNS 레코드 설정이 완료될 때까지 절대로 진행하지 말자.</p>\n<h3 id=\"주의점\">주의점 <a href=\"#주의점\">🔗</a></h3><p>DNS TXT Record가 미처 전파되지 않았음에도 불구하고 한국인 특성이 발동하여 certbot에 Enter를 눌러 인증확인 단계로 넘어가는 경우가 왕왕 발생한다.</p>\n<p>만약, TXT Record가 확인되지 않는다면, 관련 메시지와 함께 인증과정을 다시 시작한다. 문제는 이 때 <span class=\"red-600\">TXT Record에 등록할 문자열을 새로 갱신</span>한다. 즉, DNS TXT Record을 갱신된 값으로 재지정해야한다.</p>\n<p>DNS 전파가 느리다면 대기시간이 많이 늘어나버리니 주의할 것. 반드시 <code class=\"inline-code\">nslookup</code> 명령어를 통해 DNS 적용 여부를 확인하자.</p>\n<h2 id=\"4.-인증 확인 요청\">4. 인증 확인 요청 <a href=\"#4.-인증 확인 요청\">🔗</a></h2><p>DNS TXT Record가 정상적으로 전파됐다면, 콘솔에서 Enter를 눌러 다음 단계로 넘어간다. certbot이 인증확인을 시도하며, 인증이 완료되면 <span class=\"blue-600\">인증서를 발급</span>해준다.</p>\n\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>BASH</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-bash\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0><span class=\"token comment\" data-tag=\"new\"># itcode.dev는 인증한 도메인 이름</span></td></tr>\n<tr data-number=1><td class=\"line-number\" data-number=\"1\">1</td><td class=\"line-code\" data-number=1><span class=\"token builtin class-name\">cd</span> /etc/letsencrypt/live/itcode.dev</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p>기본적으로 위 경로에 인증서가 생성된다. 마지막 폴더 <code class=\"inline-code\">itcode.dev</code>는 도메인 이름이니, 각자가 입력한 도메인으로 변경하여 입력한다.</p>\n<ul>\n<li><code class=\"inline-code\">cert.pem</code> - 도메인의 인증서</li>\n<li><code class=\"inline-code\">chain.pem</code> - 발급기관의 인증서</li>\n<li><code class=\"inline-code\">fullchain.pem</code> - 도메인과 발급기관의 통합 인증서</li>\n<li><code class=\"inline-code\">privkey.pem</code> - 인증서의 개인키</li>\n</ul>\n<p>SSL은 도메인의 인증서 뿐만 아니라, 이를 발급해준 CA의 인증서까지 같이 검증한다. 도메인의 인증이 올바르더라도, 이를 발급해준 기관이 이상할 경우 해당 인증서 또한 믿을 수 없기 때문. 일종의 보증서라고 봐도 무방하다.</p>\n<p>일례로, 한국의 화폐 만원권이 만원의 가치를 가질 수 있는 이유는 한국은행이 이를 보증하기 때문. 반대로 핫한 가상화폐의 경우, 가상화폐의 가치를 보증해주는 기관이 없다. 때문에 가치가 수시로 변동하며, 언제든 그 가치와 기능을 잃을 수 있다.</p>\n<blockquote>\n<p><b class=\"teal-600\">fullchain.pem</b>의 존재의미<br>어차피 <code class=\"inline-code\">cert.pem</code>과 <code class=\"inline-code\">chain.pem</code>이 제공되는데, 둘의 통합인증서가 무슨 의미가 있냐고 생각할 수 있다. <code class=\"inline-code\">fullchain.pem</code>은 두 인증서를 통합함으로써, <code class=\"inline-code\">cert.pem</code>과 <code class=\"inline-code\">chain.pem</code>의 매칭여부를 확인할 수 있다.</p>\n</blockquote>\n<h1 id=\"Tomcat에-SSL 인증서 적용하기\">Tomcat에 SSL 인증서 적용하기 <a href=\"#Tomcat에-SSL 인증서 적용하기\">🔗</a></h1><p>Tomcat Native 설치여부에 따라 적용방법이 조금씩 달라진다. SSL 인증서는 기본적으로 <code class=\"inline-code\">pem</code> 확장자로 제공된다.</p>\n<p>Tomcat Native는 <code class=\"inline-code\">pem</code> 확장자 인증서를 바로 인식할 수 있지만, 일반적인 Tomcat은 <code class=\"inline-code\">pem</code>을 인식할 수 없어 <code class=\"inline-code\">jks</code> 등 다른 형태의 인증서로 변환해야한다.</p>\n<h2 id=\"Tomcat-Native 설치\">Tomcat Native 설치 <a href=\"#Tomcat-Native 설치\">🔗</a></h2>\n\t\t\t\t\t<div class=\"codeblock\">\n\t\t\t\t\t\t<div class=\"top\">\n\t\t\t\t\t\t\t<p>BASH</p>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<button onclick=\"copyCode(this);\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" data-icon=\"clipboard\" class=\"i-clipboard\"><path fill=\"currentColor\" d=\"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z\"></path></svg></button>\n\n\t\t\t\t\t\t<pre class=\"language-bash\"><table><tbody><tr data-number=0><td class=\"line-number\" data-number=\"0\">0</td><td class=\"line-code\" data-number=0><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> libtcnative-1</td></tr></tbody></table></pre>\n\t\t\t\t\t</div>\n\t\t\t\t<p>Ubuntu에선 위 라이브러리 설치를 통해 Tomcat Native를 적용할 수 있다.</p>\n<h2 id=\"Tomcat의-server.xml에 인증서 적용하기\">Tomcat의 server.xml에 인증서 적용하기 <a href=\"#Tomcat의-server.xml에 인증서 적용하기\">🔗</a></h2><p><a href=\"/posts/2021/08/20/apply-ssl#SSL-인증서%20적용하기\" target=\"_blank\">[SSL] Tomcat에 SSL 적용하기</a> 게시글에서 자세한 내용을 확인할 수 있다.</p>\n<p>위 게시글의 방법대로 인증서를 적용하고 Tomcat을 재기동한 뒤 <code class=\"inline-code\">https://itcode.dev</code>와 같이 HTTPS 프로토콜을 사용하여 접속을 시도하자. 반드시 접속 전에 HTTPS의 서비스 포트를 확인하자. Tomcat의 기본 HTTPS 포트는 8443이다.</p>\n<p>HTTPS 접속이 정상적이라면 성공이다. 인증서 정보 또한 확인할 수 있다.</p>\n<h1 id=\"목표\">목표 <a href=\"#목표\">🔗</a></h1><ul>\n<li><del class=\"grey-400\">라즈베리파이에 Ubuntu 서버를 구축한다.</del></li>\n<li><del class=\"grey-400\">Tomcat을 구동하여 페이지를 호스팅한다.</del></li>\n<li><del class=\"grey-400\">도메인을 입힌다.</del></li>\n<li><del class=\"grey-400\">SSL 인증서를 발급하여 HTTPS 통신을 제공한다.</del></li>\n<li>SSH, RDP 등의 원격 통신환경을 구축한다.</li>\n<li>MariaDB를 설치하여 DB 통신을 수행한다.</li>\n</ul>\n","url":["2021-09-06-raspberry-ssl-domain","2021","09","06","raspberry-ssl-domain"],"toc":[{"text":"개요","tag":"개요","depth":1},{"text":"Cerbot으로 SSL 인증서 발급하기","tag":"Cerbot으로-SSL 인증서 발급하기","depth":1},{"text":"어? 전 윈도우로 하고싶은데....","tag":"어?-전 윈도우로 하고싶은데....","depth":2},{"text":"준비물","tag":"준비물","depth":2},{"text":"1. Certbot 설치하기","tag":"1.-Certbot 설치하기","depth":2},{"text":"2. Certbot으로 인증 수행하기","tag":"2.-Certbot으로 인증 수행하기","depth":2},{"text":"3. DNS TXT Record 설정","tag":"3.-DNS TXT Record 설정","depth":2},{"text":"주의점","tag":"주의점","depth":3},{"text":"4. 인증 확인 요청","tag":"4.-인증 확인 요청","depth":2},{"text":"Tomcat에 SSL 인증서 적용하기","tag":"Tomcat에-SSL 인증서 적용하기","depth":1},{"text":"Tomcat Native 설치","tag":"Tomcat-Native 설치","depth":2},{"text":"Tomcat의 server.xml에 인증서 적용하기","tag":"Tomcat의-server.xml에 인증서 적용하기","depth":2},{"text":"목표","tag":"목표","depth":1}]},"hash":"569bbd441fd"},"__N_SSG":true}